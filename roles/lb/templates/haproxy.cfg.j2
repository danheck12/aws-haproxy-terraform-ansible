global
    log /dev/log local0
    log /dev/log local1 notice
    daemon

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5s
    timeout client  50s
    timeout server  50s

frontend http_front
    bind *:80
    default_backend web_servers

backend web_servers
    balance roundrobin
    option httpchk GET /health
    http-check expect status 200
{% for b in haproxy_backends %}
    server {{ b.name }} {{ b.address }}:{{ b.port }} check
{% endfor %}

{% if haproxy_enable_stats %}
listen stats
    bind *:{{ haproxy_stats_port }}
    stats enable
    stats uri {{ haproxy_stats_uri }}
    stats refresh 5s
    stats auth {{ haproxy_stats_user }}:{{ haproxy_stats_pass }}
{% endif %}
